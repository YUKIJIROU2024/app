<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ëøî„Åó„ÅÆÈÅî‰∫∫AI</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Hiragino Sans', 'Meiryo', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.2);
            max-width: 800px;
            width: 100%;
            padding: 30px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
        }

        h1 {
            color: #333;
            font-size: 2em;
            margin-bottom: 8px;
        }

        .ai-badge {
            display: inline-block;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
            margin-left: 10px;
        }

        .subtitle {
            color: #666;
            font-size: 0.95em;
            margin-top: 10px;
        }

        .stats-bar {
            display: flex;
            justify-content: space-around;
            margin-bottom: 25px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 12px;
        }

        .stat {
            text-align: center;
        }

        .stat-label {
            font-size: 0.85em;
            color: #888;
            margin-bottom: 4px;
        }

        .stat-value {
            font-size: 1.3em;
            font-weight: bold;
            color: #667eea;
        }

        .chat-container {
            background: #f5f6fa;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            min-height: 250px;
            max-height: 350px;
            overflow-y: auto;
        }

        .message {
            margin-bottom: 15px;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .speaker-label {
            font-size: 0.85em;
            color: #888;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .message-bubble {
            padding: 15px 18px;
            border-radius: 15px;
            line-height: 1.6;
            font-size: 1.05em;
        }

        .friend-message {
            background: white;
            color: #333;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            position: relative;
        }

        .your-response {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            margin-left: 50px;
            box-shadow: 0 2px 10px rgba(102, 126, 234, 0.3);
        }

        .situation-tag {
            display: inline-block;
            padding: 4px 12px;
            background: #ffeaa7;
            color: #d63031;
            border-radius: 20px;
            font-size: 0.85em;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .loading-indicator {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading-indicator.show {
            display: block;
        }

        .loading-dots {
            display: inline-block;
            animation: loading 1.4s infinite;
        }

        @keyframes loading {
            0%, 60%, 100% {
                transform: translateY(0);
            }
            30% {
                transform: translateY(-15px);
            }
        }

        .input-section {
            margin-top: 20px;
        }

        .response-input {
            width: 100%;
            padding: 15px;
            font-size: 1.05em;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            transition: all 0.3s;
            resize: vertical;
            min-height: 80px;
            font-family: inherit;
        }

        .response-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        button {
            padding: 12px 24px;
            font-size: 1em;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .submit-btn {
            flex: 2;
            background: linear-gradient(135deg, #00d2ff 0%, #3a7bd5 100%);
            color: white;
        }

        .submit-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(58, 123, 213, 0.3);
        }

        .generate-btn {
            flex: 2;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .generate-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(245, 87, 108, 0.3);
        }

        .evaluation {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            border: 2px solid #e0e0e0;
            display: none;
        }

        .evaluation.show {
            display: block;
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .score-display {
            text-align: center;
            margin-bottom: 20px;
        }

        .score-number {
            font-size: 3em;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .score-message {
            font-size: 1.2em;
            color: #333;
            margin-top: 10px;
            font-weight: bold;
        }

        .feedback-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }

        .feedback-title {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .good-example {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 12px;
            border-radius: 5px;
            margin-top: 10px;
        }

        .ai-thinking {
            color: #667eea;
            font-style: italic;
            text-align: center;
            padding: 10px;
            background: #f0f4ff;
            border-radius: 10px;
            margin: 10px 0;
        }

        .error-message {
            background: #fff3cd;
            color: #856404;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .progress-indicator {
            text-align: center;
            color: #888;
            font-size: 0.9em;
            margin-top: 15px;
        }

        .skill-badges {
            display: flex;
            gap: 8px;
            margin-top: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .skill-badge {
            padding: 4px 10px;
            background: #e3f2fd;
            color: #1976d2;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: bold;
        }

        .category-selector {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .category-btn {
            padding: 8px 16px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 20px;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.3s;
        }

        .category-btn:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .category-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üí¨ Ëøî„Åó„ÅÆÈÅî‰∫∫AI <span class="ai-badge">AI Powered</span></h1>
            <p class="subtitle">AI„ÅåÁîüÊàê„Åô„Çã‰ºöË©±„Å´Èã≠„ÅÑËøî„Åó„ÇíÊ±∫„ÇÅ„Çà„ÅÜ</p>
        </div>

        <div class="stats-bar">
            <div class="stat">
                <div class="stat-label">Á∑èÂêà„Çπ„Ç≥„Ç¢</div>
                <div class="stat-value" id="totalScore">0</div>
            </div>
            <div class="stat">
                <div class="stat-label">Âπ≥ÂùáË©ï‰æ°</div>
                <div class="stat-value" id="averageScore">-</div>
            </div>
            <div class="stat">
                <div class="stat-label">Á∑¥ÁøíÂõûÊï∞</div>
                <div class="stat-value" id="practiceCount">0</div>
            </div>
        </div>

        <div class="category-selector">
            <button class="category-btn active" onclick="setCategory('random')">„É©„É≥„ÉÄ„É†</button>
            <button class="category-btn" onclick="setCategory('work')">ËÅ∑Â†¥</button>
            <button class="category-btn" onclick="setCategory('friend')">Âèã‰∫∫</button>
            <button class="category-btn" onclick="setCategory('family')">ÂÆ∂Êóè</button>
            <button class="category-btn" onclick="setCategory('shopping')">Ë≤∑„ÅÑÁâ©</button>
            <button class="category-btn" onclick="setCategory('health')">ÂÅ•Â∫∑</button>
        </div>

        <div class="chat-container" id="chatContainer">
            <div class="message">
                <div class="speaker-label">„Ç∑„ÉÅ„É•„Ç®„Éº„Ç∑„Éß„É≥</div>
                <div class="situation-tag" id="situationTag">AI„Åå‰ºöË©±„ÇíÁîüÊàê„Åó„Åæ„Åô</div>
            </div>
            <div id="conversationArea">
                <div class="message">
                    <div class="speaker-label">Áõ∏Êâã</div>
                    <div class="message-bubble friend-message" id="friendMessage">
                        „ÄåÊñ∞„Åó„ÅÑ‰ºöË©±„ÇíÁîüÊàê„Äç„Éú„Çø„É≥„ÇíÊäº„Åó„Å¶„Çπ„Çø„Éº„ÉàÔºÅ
                    </div>
                </div>
            </div>
            <div class="loading-indicator" id="loadingIndicator">
                <div class="ai-thinking">AI„Åå‰ºöË©±„ÇíËÄÉ„Åà„Å¶„ÅÑ„Åæ„Åô<span class="loading-dots">...</span></div>
            </div>
        </div>

        <div class="error-message" id="errorMessage"></div>

        <div class="input-section">
            <textarea 
                class="response-input" 
                id="responseInput" 
                placeholder="Áõ∏Êâã„ÅÆË©±„Å´ÂØæ„Åó„Å¶„ÄÅÊ∞ó„ÅÆÂà©„ÅÑ„ÅüËøî„Åó„ÇÑÈã≠„ÅÑ„ÉÑ„ÉÉ„Ç≥„Éü„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ..."
                disabled
            ></textarea>
            
            <div class="button-group">
                <button class="submit-btn" id="submitBtn" onclick="submitResponse()" disabled>
                    AI„Å´Ë©ï‰æ°„Åó„Å¶„ÇÇ„Çâ„ÅÜ
                </button>
                <button class="generate-btn" id="generateBtn" onclick="generateNewConversation()">
                    Êñ∞„Åó„ÅÑ‰ºöË©±„ÇíÁîüÊàê
                </button>
            </div>
        </div>

        <div class="evaluation" id="evaluationArea">
            <div class="score-display">
                <div class="score-number" id="scoreNumber">0</div>
                <div class="score-message" id="scoreMessage"></div>
                <div class="skill-badges" id="skillBadges"></div>
            </div>
            
            <div class="feedback-section">
                <div class="feedback-title">„ÅÇ„Å™„Åü„ÅÆËøî„ÅóÔºö</div>
                <div id="userResponse"></div>
            </div>
            
            <div class="feedback-section">
                <div class="feedback-title">AI„ÅÆË©ï‰æ°„Ç≥„É°„É≥„ÉàÔºö</div>
                <div id="aiComment"></div>
            </div>
            
            <div class="feedback-section">
                <div class="feedback-title">AI„ÅåËÄÉ„Åà„ÅüËøî„Åó‰æãÔºö</div>
                <div class="good-example" id="goodExample"></div>
            </div>
        </div>

        <div class="progress-indicator" id="progressIndicator">
            Á∑¥Áøí <span id="currentRound">0</span> ÂõûÁõÆ
        </div>
    </div>

    <script>
        // Cloudflare„ÅÆWorker URLÔºà„Åì„Åì„ÇíË®≠ÂÆöÔºÅÔºâ
        const WORKER_URL = 'https://tsukkomi-ai.yukky86.workers.dev';


        let currentConversation = null;
        let totalScore = 0;
        let practiceCount = 0;
        let scores = [];
        let currentCategory = 'random';

        // „Ç´„ÉÜ„Ç¥„É™Ë®≠ÂÆö
        function setCategory(category) {
            currentCategory = category;
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        // AI„ÅåÊñ∞„Åó„ÅÑ‰ºöË©±„ÇíÁîüÊàêÔºàÂÆüÈöõ„ÅÆAPIÂëº„Å≥Âá∫„ÅóÔºâ
        async function generateNewConversation() {
            showLoading(true);
            
            // „Éú„Çø„É≥„ÇíÁÑ°ÂäπÂåñ
            document.getElementById('generateBtn').disabled = true;
            document.getElementById('submitBtn').disabled = true;
            
            try {
                // Cloudflare Workers AI„ÇíÂëº„Å≥Âá∫„Åó
                const response = await fetch(`${WORKER_URL}/generate`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        category: currentCategory 
                    })
                });
                
                if (!response.ok) {
                    throw new Error('‰ºöË©±„ÅÆÁîüÊàê„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                }
                
                const conversation = await response.json();
                currentConversation = conversation;
                
                // UI„ÇíÊõ¥Êñ∞
                document.getElementById('situationTag').textContent = conversation.situation;
                document.getElementById('friendMessage').textContent = conversation.message;
                document.getElementById('responseInput').value = '';
                document.getElementById('responseInput').disabled = false;
                document.getElementById('submitBtn').disabled = false;
                document.getElementById('evaluationArea').classList.remove('show');
                document.getElementById('errorMessage').classList.remove('show');
                
                // Áµ±Ë®àÊõ¥Êñ∞
                practiceCount++;
                document.getElementById('currentRound').textContent = practiceCount;
                document.getElementById('practiceCount').textContent = practiceCount;
                
                // ÂÖ•ÂäõÊ¨Ñ„Å´„Éï„Ç©„Éº„Ç´„Çπ
                document.getElementById('responseInput').focus();
                
            } catch (error) {
                console.error('Error:', error);
                showError('‰ºöË©±„ÅÆÁîüÊàê„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ„ÇÇ„ÅÜ‰∏ÄÂ∫¶„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ„ÄÇ');
                // „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ„Å®„Åó„Å¶ÂæìÊù•„ÅÆÊñπÊ≥ï„Çí‰ΩøÁî®
                const conversation = generateConversationByCategory(currentCategory);
                currentConversation = conversation;
                document.getElementById('situationTag').textContent = conversation.situation;
                document.getElementById('friendMessage').textContent = conversation.message;
                document.getElementById('responseInput').disabled = false;
                document.getElementById('submitBtn').disabled = false;
            } finally {
                showLoading(false);
                document.getElementById('generateBtn').disabled = false;
            }
        }

        // „Ç´„ÉÜ„Ç¥„É™„Å´Âü∫„Å•„ÅÑ„Å¶‰ºöË©±„ÇíÁîüÊàê
        function generateConversationByCategory(category) {
            const templates = {
                work: [
                    {
                        situation: "ËÅ∑Â†¥„Åß„ÅÆÊòº‰ºë„Åø",
                        patterns: [
                            "ÊúÄËøë„ÄÅ‰ªï‰∫ã„ÅÆÂäπÁéá„Çí‰∏ä„Åí„Çã„Åü„ÇÅ„Å´{method}„ÇíÂßã„ÇÅ„Åü„Çì„Åß„Åô„Åë„Å©„ÄÅ{contradiction}„Åó„Å°„ÇÉ„Å£„Å¶„ÄÅÁµêÂ±Ä{result}„Å™„Çì„Åß„Åô„Çà„Å≠„ÄÇ„Åß„ÇÇ{excuse}„Åã„Çâ„ÄÅ„Åì„Çå„Åß„ÅÑ„ÅÑ„Å®ÊÄù„ÅÜ„Çì„Åß„Åô„ÄÇ",
                        ]
                    }
                ],
                friend: [
                    {
                        situation: "Âèã‰∫∫„Å®„ÅÆ„Ç´„Éï„Çß",
                        patterns: [
                            "„Åì„ÅÆÂâç{goal}„Åó„Çà„ÅÜ„Å®ÊÄù„Å£„Å¶„ÄÅ{action}„Åó„Åü„Çì„Å†„Åë„Å©„ÄÅ{unexpected}„Åó„Å°„ÇÉ„Å£„Å¶„ÄÇ„Åß„ÇÇ{positive_spin}„Å†„Åã„Çâ„ÄÅ„ÇÄ„Åó„ÇçËâØ„Åã„Å£„Åü„Åã„ÇÇÔºÅ",
                        ]
                    }
                ],
                family: [
                    {
                        situation: "ÂÆ∂Êóè„Å®„ÅÆÂ§ïÈ£ü",
                        patterns: [
                            "ÊúÄËøë{trend}„Å´„Éè„Éû„Å£„Å¶„Å¶„ÄÅ{investment}„Åó„Åü„ÅÆ„ÄÇ{problem}„Åë„Å©„ÄÅ{justification}„Åã„ÇâÂ§ß‰∏àÂ§´„Å†„Çà„Å≠„ÄÇ",
                        ]
                    }
                ],
                shopping: [
                    {
                        situation: "„Ç∑„Éß„ÉÉ„Éî„É≥„Ç∞‰∏≠",
                        patterns: [
                            "{saving_goal}„Å®ÊÄù„Å£„Å¶{shop}„Å´Ë°å„Å£„Åü„Çì„Å†„Åë„Å©„ÄÅ{temptation}„Åå„ÅÇ„Å£„Å¶„ÄÅÁµêÂ±Ä{result}Ë≤∑„Å£„Å°„ÇÉ„Å£„Åü„ÄÇ„Åß„ÇÇ{rationalization}„Å†„Åã„Çâ„ÄÅ„ÅäÂæó„Å†„Çà„Å≠Ôºü",
                        ]
                    }
                ],
                health: [
                    {
                        situation: "„Ç∏„É†„Åß„ÅÆ‰ºöË©±",
                        patterns: [
                            "{health_goal}„Åü„ÇÅ„Å´{action}„Åó„Å¶„Çã„Çì„Åß„Åô„ÄÇ„Åæ„ÅÇ„ÄÅ{contradiction}„ÇÇ„Åó„Å¶„Åæ„Åô„Åë„Å©„ÄÅ{excuse}„Åã„ÇâÂïèÈ°å„Å™„ÅÑ„Åß„Åô„Çà„Å≠„ÄÇ{duration}Á∂ö„ÅÑ„Å¶„Çã„Åó„ÄÇ",
                        ]
                    }
                ]
            };

            // „É©„É≥„ÉÄ„É†„Å™Ë¶ÅÁ¥†„ÇíÁîüÊàê
            const elements = {
                method: ["„Éù„É¢„Éâ„Éº„É≠„ÉÜ„ÇØ„Éã„ÉÉ„ÇØ", "Êó©ÊúùÂá∫Á§æ", "„Éû„É´„ÉÅ„Çø„Çπ„ÇØ", "„Éá„Çπ„ÇØÊï¥ÁêÜ"],
                contradiction: ["‰ºëÊÜ©ÊôÇÈñì„ÅåÈï∑„Åè„Å™„Çä", "SNS„ÉÅ„Çß„ÉÉ„ÇØ„ÅåÂ¢ó„Åà", "„Ç≥„Éº„Éí„Éº„Éñ„É¨„Ç§„ÇØ„ÅåÈ†ªÁπÅ„Å´„Å™„Çä"],
                result: ["Ââç„Çà„ÇäÊôÇÈñì„Åã„Åã„Å£„Å¶„Çã", "ÊÆãÊ•≠„ÅåÂ¢ó„Åà„Åü", "Áñ≤„Çå„ÇÑ„Åô„Åè„Å™„Å£„Åü"],
                excuse: ["„É™„Éï„É¨„ÉÉ„Ç∑„É•„ÅØÂ§ß‰∫ã", "ÊÉÖÂ†±ÂèéÈõÜ„ÇÇ‰ªï‰∫ã", "Ë≥™„Åå‰∏ä„Åå„Å£„Å¶„Çã"],
                goal: ["ÁØÄÁ¥Ñ", "„ÉÄ„Ç§„Ç®„ÉÉ„Éà", "ÂãâÂº∑", "Êó©ÂØùÊó©Ëµ∑„Åç"],
                action: ["„Ç¢„Éó„É™„Çí„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ", "Êú¨„ÇíË≤∑„Å£„Åü", "„Ç∏„É†„Å´ÂÖ•‰ºö", "Ë®àÁîª„ÇíÁ´ã„Å¶„Åü"],
                unexpected: ["ÂÖ®ÁÑ∂‰Ωø„Å£„Å¶„Å™„ÅÑ", "3Êó•„ÅßÈ£Ω„Åç„Åü", "‰∏ÄÂõû„ÇÇË°å„Å£„Å¶„Å™„ÅÑ", "Ë®àÁîªÂÄí„Çå"],
                positive_spin: ["ÊÑèË≠ò„ÅåÂ§â„Çè„Å£„Åü", "„ÇÑ„ÇãÊ∞ó„ÅØÂá∫„Åü", "Ê∫ñÂÇô„ÅØÊï¥„Å£„Åü", "Ê∞óÊåÅ„Å°„ÅØÂâçÂêë„Åç"],
                trend: ["Êñ≠Êç®Èõ¢", "„Éü„Éã„Éû„É™„Çπ„Éà", "ÊäïË≥á", "„Ç™„Éº„Ç¨„Éã„ÉÉ„ÇØÁîüÊ¥ª"],
                investment: ["Â§ßÈáè„Å´Âá¶ÂàÜ", "È´òÁ¥öÂìÅ„ÇíË≥ºÂÖ•", "„Çª„Éü„Éä„Éº„Å´ÂèÇÂä†", "‰ºöÂì°„Å´„Å™„Å£„Åü"],
                problem: ["„Åô„Åê„É™„Éê„Ç¶„É≥„Éâ„Åó„Åü", "‰Ωø„ÅÑ„Åì„Å™„Åõ„Å¶„Å™„ÅÑ", "„Çà„Åè„Çè„Åã„Çâ„Å™„ÅÑ", "ÂäπÊûú„ÇíÊÑü„Åò„Å™„ÅÑ"],
                justification: ["Èï∑ÊúüÁöÑ„Å´Ë¶ã„Çå„Å∞", "ÁµåÈ®ì„ÅåÂ§ß‰∫ã", "„ÅÑ„Å§„ÅãÂΩπÁ´ã„Å§", "ÂÅ•Â∫∑„Å´„ÅØËâØ„ÅÑ"],
                saving_goal: ["ÁØÄÁ¥Ñ„Åó„Çà„ÅÜ", "ÁÑ°ÈßÑÈÅ£„ÅÑ„Çí„ÇÑ„ÇÅ„Çà„ÅÜ", "ÂøÖË¶Å„Å™„ÇÇ„ÅÆ„Å†„ÅëË≤∑„Åä„ÅÜ"],
                shop: ["„Çª„Éº„É´", "„Ç¢„Ç¶„Éà„É¨„ÉÉ„Éà", "ÁôæÂùá", "„Éá„Ç£„Çπ„Ç´„Ç¶„É≥„Éà„Çπ„Éà„Ç¢"],
                temptation: ["ÈôêÂÆöÂìÅ", "70%OFF", "„Çø„Ç§„É†„Çª„Éº„É´", "„Éù„Ç§„É≥„Éà10ÂÄç"],
                rationalization: ["ÂÖÉÂÄ§„ÇíËÄÉ„Åà„Çå„Å∞", "„ÅÑ„Å§„Åã‰Ωø„ÅÜ", "ÂÆâ„ÅÑ„ÅÜ„Å°„Å´", "„Éù„Ç§„É≥„Éà„ÇÇË≤Ø„Åæ„Å£„Åü"],
                health_goal: ["Áó©„Åõ„Çã", "Á≠ãËÇâ„Çí„Å§„Åë„Çã", "‰ΩìÂäõÂêë‰∏ä", "ÂÅ•Â∫∑Á∂≠ÊåÅ"],
                duration: ["„ÇÇ„ÅÜ2Êó•„ÇÇ", "‰ªäÈÄ±„Åß3ÂõûÁõÆ", "ÂÖàÊúà„Åã„Çâ", "„Åì„ÅÆ1ÈÄ±Èñì"]
            };

            // „Ç´„ÉÜ„Ç¥„É™„Å´Âøú„Åò„Å¶„ÉÜ„É≥„Éó„É¨„Éº„Éà„ÇíÈÅ∏Êäû
            let selectedTemplate;
            if (category === 'random') {
                const allCategories = Object.keys(templates);
                const randomCat = allCategories[Math.floor(Math.random() * allCategories.length)];
                selectedTemplate = templates[randomCat][0];
            } else {
                selectedTemplate = templates[category] ? templates[category][0] : templates.work[0];
            }

            // „Éë„Çø„Éº„É≥„Çí„É©„É≥„ÉÄ„É†„Å´ÈÅ∏Êäû„Åó„ÄÅË¶ÅÁ¥†„ÇíÂüã„ÇÅËæº„ÇÄ
            let pattern = selectedTemplate.patterns[Math.floor(Math.random() * selectedTemplate.patterns.length)];
            
            // Ë¶ÅÁ¥†„ÇíÁΩÆÊèõ
            Object.keys(elements).forEach(key => {
                const regex = new RegExp(`{${key}}`, 'g');
                if (pattern.includes(`{${key}}`)) {
                    const values = elements[key];
                    const value = values[Math.floor(Math.random() * values.length)];
                    pattern = pattern.replace(regex, value);
                }
            });

            return {
                situation: selectedTemplate.situation,
                message: pattern,
                category: category
            };
        }

        // „É¨„Çπ„Éù„É≥„Çπ„ÇíÈÄÅ‰ø°„Åó„Å¶Ë©ï‰æ°
        function submitResponse() {
            const userResponse = document.getElementById('responseInput').value.trim();
            
            if (!userResponse) {
                alert('Ëøî„Åó„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºÅ');
                return;
            }
            
            showLoading(true);
            document.getElementById('submitBtn').disabled = true;
            document.getElementById('generateBtn').disabled = true;
            
            // AI„ÅåË©ï‰æ°„Åô„Çã„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥
            setTimeout(() => {
                const evaluation = evaluateWithAI(userResponse, currentConversation);
                displayEvaluation(evaluation, userResponse);
                
                // „Çπ„Ç≥„Ç¢Êõ¥Êñ∞
                totalScore += evaluation.score;
                scores.push(evaluation.score);
                updateStats();
                
                showLoading(false);
                document.getElementById('responseInput').disabled = true;
                document.getElementById('generateBtn').disabled = false;
            }, 1500);
        }

        // AI„Å´„Çà„ÇãË©ï‰æ°Ôºà„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥Ôºâ
        function evaluateWithAI(response, conversation) {
            // ÂÆüÈöõ„Å´„ÅØ„Åì„Åì„ÅßAI API„ÇíÂëº„Çì„ÅßË©ï‰æ°„ÇíÂèñÂæó
            const score = Math.floor(Math.random() * 40) + 60; // 60-100„ÅÆ„É©„É≥„ÉÄ„É†„Çπ„Ç≥„Ç¢
            
            const evaluations = {
                high: {
                    message: "Á¥†Êô¥„Çâ„Åó„ÅÑËøî„Åó„Åß„ÅôÔºÅÁüõÁõæÁÇπ„ÇíÁöÑÁ¢∫„Å´ÊåáÊëò„Åó„Å¶„ÅÑ„Åæ„Åô„Å≠„ÄÇ",
                    badges: ["Èã≠„ÅÑË¶≥ÂØüÁúº", "„É¶„Éº„É¢„Ç¢„Çª„É≥„Çπ", "ÁöÑÁ¢∫„Å™ÊåáÊëò"],
                    example: "„Äå" + generateGoodResponse(conversation.message) + "„Äç",
                    comment: "Áõ∏Êâã„ÅÆË©±„ÅÆÊ†∏ÂøÉÁöÑ„Å™ÁüõÁõæ„Çí„ÄÅ„É¶„Éº„É¢„Ç¢„Çí‰∫§„Åà„Å¶ÊåáÊëò„Åß„Åç„Å¶„ÅÑ„Åæ„Åô„ÄÇ‰ºöË©±„ÅÆÊµÅ„Çå„ÇíÂ£ä„Åï„Åö„ÄÅÁõ∏Êâã„ÇÇÁ¨ëÈ°î„Å´„Å™„Çå„ÇãÁµ∂Â¶ô„Å™Ëøî„Åó„Åß„Åô„ÄÇ"
                },
                medium: {
                    message: "„ÅÑ„ÅÑËøî„Åó„Åß„ÅôÔºÅ„ÇÇ„ÅÜÂ∞ë„ÅóÂÖ∑‰ΩìÁöÑ„Å´ÁüõÁõæ„ÇíÊåáÊëò„Åô„Çã„Å®Êõ¥„Å´ËâØ„Åè„Å™„Çä„Åæ„Åô„ÄÇ",
                    badges: ["ËâØ„ÅÑÁùÄÁúºÁÇπ", "‰ºöË©±Âäõ"],
                    example: "„Äå" + generateGoodResponse(conversation.message) + "„Äç",
                    comment: "„Éù„Ç§„É≥„Éà„ÅØÊäº„Åï„Åà„Å¶„ÅÑ„Åæ„Åô„Åå„ÄÅ„ÇÇ„ÅÜÂ∞ë„ÅóÂÖ∑‰ΩìÁöÑ„Å™Êï∞Â≠ó„ÇÑÁä∂Ê≥Å„Çí‰Ωø„Å£„Å¶Ëøî„Åô„Å®„ÄÅ„Çà„ÇäË™¨ÂæóÂäõ„ÅåÂ¢ó„Åó„Åæ„Åô„ÄÇ"
                },
                low: {
                    message: "Ëøî„Åó„Å®„Åó„Å¶„ÅØÊàêÁ´ã„Åó„Å¶„ÅÑ„Åæ„Åô„Åå„ÄÅÁõ∏Êâã„ÅÆÁüõÁõæ„Çí„ÇÇ„Å£„Å®Èã≠„ÅèÊåáÊëò„Åó„Å¶„Åø„Åæ„Åó„Çá„ÅÜ„ÄÇ",
                    badges: ["„ÉÅ„É£„É¨„É≥„Ç∏„É£„Éº"],
                    example: "„Äå" + generateGoodResponse(conversation.message) + "„Äç",
                    comment: "Áõ∏Êâã„ÅÆË©±„Çí„Çà„ÅèËÅû„ÅÑ„Å¶„ÄÅ„Äé„Åù„Çå„Å£„Å¶‚óã‚óã„Åò„ÇÉ„Å™„ÅÑÔºü„Äè„Å®„ÅÑ„ÅÜÂΩ¢„ÅßÁüõÁõæ„ÇíÊåáÊëò„Åó„Å¶„Åø„Åæ„Åó„Çá„ÅÜ„ÄÇ"
                }
            };
            
            let evaluation;
            if (score >= 85) {
                evaluation = evaluations.high;
            } else if (score >= 70) {
                evaluation = evaluations.medium;
            } else {
                evaluation = evaluations.low;
            }
            
            return {
                score: score,
                ...evaluation
            };
        }

        // ËâØ„ÅÑËøî„Åó„ÅÆ‰æã„ÇíÁîüÊàê
        function generateGoodResponse(message) {
            const responses = [
                "„Åù„Çå„Å£„Å¶ÊúÄÂàù„ÅÆÁõÆÁöÑ„Å®ÁúüÈÄÜ„ÅÆÁµêÊûú„Å´„Å™„Å£„Å¶„Å™„ÅÑÔºü",
                "‰∏ÄÂë®Âõû„Å£„Å¶ÂÖÉ„ÅÆÂ†¥ÊâÄ„Å´Êàª„Å£„Å¶„Åç„ÅüÊÑü„Åò„Å†„Å≠",
                "„Åù„ÅÆÁêÜË´ñ„Å†„Å®„ÄÅ„Åø„Çì„Å™ÊàêÂäü„Åó„Å¶„Çã„ÅØ„Åö„Å†„Åë„Å©...",
                "ÂäπÁéá„Çí‰∏ä„Åí„ÇãÊñπÊ≥ï„ÇíË¶ãÁõ¥„Åó„ÅüÊñπ„ÅåÂäπÁéáÁöÑ„Åã„ÇÇ",
                "„Åù„Çå„ÄÅÊú¨Êú´Ëª¢ÂÄí„ÅÆÊïôÁßëÊõ∏„Å´Ëºâ„Åõ„Åü„ÅÑ„É¨„Éô„É´"
            ];
            return responses[Math.floor(Math.random() * responses.length)];
        }

        // Ë©ï‰æ°„ÇíË°®Á§∫
        function displayEvaluation(evaluation, userResponse) {
            const evaluationArea = document.getElementById('evaluationArea');
            const scoreNumber = document.getElementById('scoreNumber');
            const scoreMessage = document.getElementById('scoreMessage');
            const userResponseDiv = document.getElementById('userResponse');
            const goodExample = document.getElementById('goodExample');
            const aiComment = document.getElementById('aiComment');
            const skillBadges = document.getElementById('skillBadges');
            
            scoreNumber.textContent = evaluation.score;
            scoreMessage.textContent = evaluation.message;
            userResponseDiv.textContent = userResponse;
            goodExample.textContent = evaluation.example;
            aiComment.textContent = evaluation.comment;
            
            // „Çπ„Ç≠„É´„Éê„ÉÉ„Ç∏Ë°®Á§∫
            skillBadges.innerHTML = '';
            evaluation.badges.forEach(badge => {
                const badgeDiv = document.createElement('div');
                badgeDiv.className = 'skill-badge';
                badgeDiv.textContent = badge;
                skillBadges.appendChild(badgeDiv);
            });
            
            evaluationArea.classList.add('show');
        }

        // Áµ±Ë®à„ÇíÊõ¥Êñ∞
        function updateStats() {
            document.getElementById('totalScore').textContent = totalScore;
            
            if (scores.length > 0) {
                const average = Math.round(scores.reduce((a, b) => a + b, 0) / scores.length);
                document.getElementById('averageScore').textContent = average;
            }
        }

        // „É≠„Éº„Éá„Ç£„É≥„Ç∞Ë°®Á§∫
        function showLoading(show) {
            const loadingIndicator = document.getElementById('loadingIndicator');
            if (show) {
                loadingIndicator.classList.add('show');
            } else {
                loadingIndicator.classList.remove('show');
            }
        }

        // „Ç®„É©„ÉºË°®Á§∫
        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.classList.add('show');
            setTimeout(() => {
                errorDiv.classList.remove('show');
            }, 5000);
        }

        // Enter„Ç≠„Éº„ÅßÈÄÅ‰ø°ÔºàShift+Enter„ÅØÊîπË°åÔºâ
        document.getElementById('responseInput').addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !e.shiftKey && !this.disabled) {
                e.preventDefault();
                submitResponse();
            }
        });
    </script>
</body>
</html>